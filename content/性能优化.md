## 性能优化原则

### 让加载更快
- 减少资源体积
  + 压缩代码
- 减少访问次数
  + 合并代码
  + SSR服务器端渲染
  + 缓存
- 使用更快的网络
  + CDN

### 让渲染更快
- CSS 放在 head, JS 放在 body 最下面
- 尽早开始执行 JS, 用 DOMContentLoaded 触发
- 懒加载
- 对 DOM 查询进行缓存
- 频繁 DOM 操作，合并到一起插入 DOM 结构
- 节流、防抖

## SSR
- 服务器端渲染：将网页和数据一起加载，一起渲染
- 非SSR(前后端分离)：先加载网页，再加载数据，再渲染数据


前端性能首先分为首屏和其他

## 首屏

- 压缩文件 JS CSS Img 文件压缩
- 使用 CDN
- CSS 是会阻塞页面构建的
- **建议减少关键 CSS 元素数量** 

前端构建 DOM 树的影响因素有 CSS 和 JS

CSS 要避免深度嵌套

JS 可以适当的使用 async 或者 defer 来异步下载, defer 延迟执行, async 异步下载但下载完成后立即执行, 不能保证顺序



## 雅虎军规

### 14条雅虎军规

1. 减少Http请求
2. 使用CDN（内容分发网络）
3. 添加Exprire/Cache-Control头
4. 使用Gzip压缩
5. 将Css放在页面的最上面
6. 将script放在页面的最下面
7. 经量避免使用Css Expressions(CSS表达式)
8. 将脚本文件和样式文件都放在外部文件中
9. 减少DNS查找
10. 最小化JavaScript和Css
11. 避免重定向
12. 移除重复的脚本
13. 配置实体标签ETag
14. 使用Ajax缓存

### 性能优化概况

- 网络部分
  - 尽量减少HTTP请求数
    - 合并文件
    - 雪碧图
    - 小图Base64
  - 减少DNS查找
    - 开启DNS预解析
  - 使用CND静态资源服务器
  - 避免重定向
  - 杜绝404
- 缓存
  - 配置ETags
    - 实体标签（ETags），是服务器和浏览器用来决定浏览器缓存中组件与源服务器中的组件是否匹配的一种机制
  - 添上Expires或者Cache-Control HTTP头
  - 使用外链的方式引入JS和CSS（缓存）
- 内容部分
  - 按需加载组件
  - 预加载组件
  - 减少DOM元素的数量
  - 尽量少用iframe
  - 压缩JavaScript和CSS（代码层面）
- CSS 部分
  - 避免使用CSS表达式
  - 选择``而不是`@import`
  - 避免使用滤镜
  - 把样式表放在顶部
- JS 部分
  - 把脚本放在底部
  - 去除重复脚本
  - 减少DOM访问
- 图片部分
  - 选用合适的图片格式
  - 雪碧图中间少留空白
  - 不要用HTML缩放图片，要小图就去加载小图
  - 用小的可缓存的favicon.ico
- cookie
  - 给cookie减肥
    - 清除不必要的cookie
    - cookie尽可能小
    - 设置好合适的域
    - 合适的有效期
  - 把静态资源放在不含cookie的域下
    - 当浏览器发送对静态图像的请求时，cookie也会一起发送，而服务器根本不需要这些cookie。
- 移动端
  - 保证所有组件都小于25K
  - 把组件打包到一个复合文档里
- 服务器
  - 开启Gzip等压缩
  - 避免图片src属性为空（为空浏览器也会向服务器发送另一个请求）
  - 对Ajax用GET请求
  - 尽早清空缓冲区
  - 使用CDN（内容分发网络）
    - 内容分发网络（CDN）是一组分散在不同地理位置的web服务器，用来给用户更高效地发送内容



## 其他

合理的使用缓存, 比如 百度 在前端缓存了很多文件, 就是为了增加渲染速度

懒加载

> 图片懒加载, 使用 offsetTop, scrollTop, clientHeight 来判断图片是否进入视野, 即将进入视野的时候会发送请求

预加载

> 使用 img 首先下载好图片, 但不显示
>
> 使用 Image 对象加载

防抖

> 具体看防抖, 节流

节流

文件压缩

> gzip压缩

代码质量优化,不要过深嵌套或者访问属性

> JS 层面, CSS 也是一样

网页层数

> 对于频繁更新的 DOM 可以使用 translate 来新建一个图层, 这样图层更新不会影响其他的 DOM

离线操作dom

重绘与重排

> 当元素大小, 布局变化, 就需要重排, 当元素颜色, 透明度变化就需要重绘
>
> 重排一定会重绘, 重绘不一定重拍

css优化

> 避免过度详细的去访问一个元素

使用cdn

> CDN 大部分时间可以保证资源迅速的下载下来, 浪费在下载的时间少



## React 项目性能优化

1. shouldComponentUpdate()
2. 使用 PureComponent
3. 对于不需要自身 state 以及生命周期函数的组件 使用 function

